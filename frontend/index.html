<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YOLOv4 Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>
<body class="h-full flex items-center justify-center p-4">
  <div id="app" class="w-full max-w-md bg-white shadow-lg rounded-lg p-6">
    <h1 class="text-2xl font-bold mb-4 text-center">YOLOv4 Inference</h1>

    <form @submit.prevent="submit" class="space-y-4">
      <input
        type="file"
        ref="fileInput"
        accept="image/*"
        required
        class="block w-full text-sm text-gray-500
               file:mr-4 file:py-2 file:px-4
               file:rounded file:border-0
               file:text-sm file:font-semibold
               file:bg-blue-50 file:text-blue-700
               hover:file:bg-blue-100"
      />

      <button
        type="submit"
        class="w-full bg-blue-600 text-white py-2 rounded-lg
               hover:bg-blue-700 transition"
      >
        Run YOLO
      </button>
    </form>

    <div v-if="imageData" class="mt-6">
      <h2 class="text-xl font-semibold mb-2 text-center">Result</h2>
      <img
        :src="imageData"
        alt="Processed"
        class="w-full rounded-lg border"
      />
    </div>
  </div>

  <script>
    const { createApp, ref } = Vue;

    createApp({
      setup() {
        const fileInput = ref(null);
        const imageData = ref(null);

        const submit = async () => {
          imageData.value = null;  // clear previous

          const file = fileInput.value.files[0];
          if (!file) return;

          const form = new FormData();
          form.append('file', file);

          let res;
          try {
            res = await fetch('/api/upload', {
              method: 'POST',
              body: form
            });
          } catch (e) {
            return alert('Network error:\n' + e);
          }

          if (!res.ok) {
            const err = await res.text();
            return alert('Server error:\n' + err);
          }

          let json;
          try {
            json = await res.json();
          } catch (e) {
            return alert('Invalid JSON response.');
          }

          if (json.image_data) {
            imageData.value = json.image_data;
          } else {
            alert('Error: ' + JSON.stringify(json));
          }
        };

        return { fileInput, imageData, submit };
      }
    }).mount('#app');
  </script>
</body>
</html>

